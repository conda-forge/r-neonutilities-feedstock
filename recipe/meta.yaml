{% set version = "3.0.2" %}
{% set posix = 'm2-' if win else '' %}

package:
  name: r-neonutilities
  version: {{ version|replace("-", "_") }}

source:
  url:
    - {{ cran_mirror }}/src/contrib/neonUtilities_{{ version }}.tar.gz
    - {{ cran_mirror }}/src/contrib/Archive/neonUtilities/neonUtilities_{{ version }}.tar.gz
  sha256: 63757d0553e8dce62b03d85819e45da5d694da81067172d09e1709780de119a0

build:
  number: 0
  noarch: generic
  rpaths:
    - lib/R/lib/
    - lib/
  missing_dso_whitelist:
    - '*/R.dll'        # [win]
    - '*/Rblas.dll'    # [win]
    - '*/Rlapack.dll'  # [win]

requirements:
  build:
    - {{ posix }}zip               # [win]
    - cross-r-base {{ r_base }}    # [build_platform != target_platform]
  host:
    - r-base
    - r-r.utils
    - r-arrow
    - r-curl
    - r-data.table >=1.17.8
    - r-downloader
    - r-dplyr
    - r-httr
    - r-jose
    - r-jsonlite
    - r-pbapply
    - r-rlang
    - r-tidyr
  run:
    - r-base
    - r-r.utils
    - r-arrow
    - r-curl
    - r-data.table >=1.17.8
    - r-downloader
    - r-dplyr
    - r-httr
    - r-jose
    - r-jsonlite
    - r-pbapply
    - r-rlang
    - r-tidyr

test:
  requires:
    - r-testthat
  source_files:
    - tests/
  commands:
    - $R -e "library('neonUtilities')"  # [not win]
    - $R -e "testthat::test_file('tests/testthat.R', stop_on_failure=TRUE)"  # [not win]
    - "\"%R%\" -e \"library('neonUtilities')\""  # [win]
    # c.f. https://github.com/conda-forge/staged-recipes/pull/30115#issuecomment-2902965608
    # - "\"%R%\" -e \"testthat::test_file('tests/testthat.R', stop_on_failure=TRUE)\""  # [win]

about:
  home: https://github.com/NEONScience/NEON-utilities
  license: AGPL-3.0-only
  summary: Utilities for Working with NEON Data
  description: |
    NEON data packages can be accessed through the NEON Data Portal <https://www.neonscience.org>
    or through the NEON Data API (see <https://data.neonscience.org/data-api> for documentation).
    Data delivered from the Data Portal are provided as monthly zip files packaged within
    a parent zip file, while individual files can be accessed from the API. This package
    provides tools that aid in discovering, downloading, and reformatting data prior
    to use in analyses. This includes downloading data via the API, merging data tables
    by type, and converting formats. For more information, see the readme file at <https://github.com/NEONScience/NEON-utilities>.
  license_family: AGPL
  license_file:
    - '{{ environ["PREFIX"] }}/lib/R/share/licenses/AGPL-3'
  dev_url: https://github.com/NEONScience/NEON-utilities

extra:
  recipe-maintainers:
    - conda-forge/r
    - cklunch
    - matthewfeickert
